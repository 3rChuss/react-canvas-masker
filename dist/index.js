!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports["@3rchuss/react-masker"]=t(require("react")):e["@3rchuss/react-masker"]=t(e.react)}(self,e=>(()=>{var t={296:(e,t,r)=>{var n=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,i=/^0o[0-7]+$/i,u=parseInt,c="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,s="object"==typeof self&&self&&self.Object===Object&&self,l=c||s||Function("return this")(),f=Object.prototype.toString,d=Math.max,v=Math.min,h=function(){return l.Date.now()};function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==f.call(e)}(e))return NaN;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(n,"");var r=o.test(e);return r||i.test(e)?u(e.slice(2),r?2:8):a.test(e)?NaN:+e}e.exports=function(e,t,r){var n,a,o,i,u,c,s=0,l=!1,f=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var r=n,o=a;return n=a=void 0,s=t,i=e.apply(o,r)}function g(e){var r=e-c;return void 0===c||r>=t||r<0||f&&e-s>=o}function k(){var e=h();if(g(e))return w(e);u=setTimeout(k,function(e){var r=t-(e-c);return f?v(r,o-(e-s)):r}(e))}function w(e){return u=void 0,m&&n?b(e):(n=a=void 0,i)}function x(){var e=h(),r=g(e);if(n=arguments,a=this,c=e,r){if(void 0===u)return function(e){return s=e,u=setTimeout(k,t),l?b(e):i}(c);if(f)return u=setTimeout(k,t),b(c)}return void 0===u&&(u=setTimeout(k,t)),i}return t=p(t)||0,y(r)&&(l=!!r.leading,o=(f="maxWait"in r)?d(p(r.maxWait)||0,t):o,m="trailing"in r?!!r.trailing:m),x.cancel=function(){void 0!==u&&clearTimeout(u),s=0,n=c=a=u=void 0},x.flush=function(){return void 0===u?i:w(h())},x}},392:(e,t,r)=>{"use strict";r.r(t)},513:function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.MaskEditor=void 0;var a=r(156);r(392);var o=r(907);t.MaskEditor=function(e){var t=e.canvasRef,r=n(e,["canvasRef"]),i=(0,o.useMaskEditor)(r),u=i.canvasRef,c=i.maskCanvasRef,s=i.cursorCanvasRef,l=i.size,f=i.handleMouseDown,d=i.handleMouseUp,v=i.undo,h=i.redo,y=i.clear,p=i.maskOpacity,m=i.maskBlendMode;return a.useImperativeHandle(t,function(){return{maskCanvas:c.current,undo:v,redo:h,clear:y}},[c,v,h,y]),a.createElement("div",{className:"react-mask-editor-outer"},a.createElement("div",{className:"react-mask-editor-inner",style:{width:l.x,height:l.y}},a.createElement("canvas",{ref:u,style:{width:l.x,height:l.y},width:l.x,height:l.y,className:"react-mask-editor-base-canvas"}),a.createElement("canvas",{ref:c,width:l.x,height:l.y,style:{width:l.x,height:l.y,opacity:p,mixBlendMode:m},className:"react-mask-editor-mask-canvas"}),a.createElement("canvas",{ref:s,width:l.x,height:l.y,onMouseUp:d,onMouseDown:f,style:{width:l.x,height:l.y},className:"react-mask-editor-cursor-canvas"})))}},949:function(e,t,r){"use strict";var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.useMaskEditorContext=t.MaskEditorProvider=void 0;var a=r(156),o=r(907),i=a.createContext(void 0);t.MaskEditorProvider=function(e){var t=e.children,r=n(e,["children"]),u=(0,o.useMaskEditor)(r);return a.createElement(i.Provider,{value:u},t)},t.useMaskEditorContext=function(){var e=a.useContext(i);if(!e)throw new Error("useMaskEditorContext must be used within a MaskEditorProvider");return e}},907:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function u(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,u)}c((n=n.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.useMaskEditor=t.MaskEditorDefaults=void 0;var o=r(156),i=r(593),u=r(296);t.MaskEditorDefaults={cursorSize:10,maskOpacity:.4,maskColor:"#ffffff",maskBlendMode:"normal"},t.useMaskEditor=function(e){var r=this,c=e.src,s=e.cursorSize,l=void 0===s?t.MaskEditorDefaults.cursorSize:s,f=e.maskColor,d=void 0===f?t.MaskEditorDefaults.maskColor:f,v=e.maskBlendMode,h=void 0===v?t.MaskEditorDefaults.maskBlendMode:v,y=e.maskOpacity,p=void 0===y?t.MaskEditorDefaults.maskOpacity:y,m=e.onCursorSizeChange,b=e.onDrawingChange,g=e.onUndoRequest,k=e.onRedoRequest,w=e.onMaskChange,x=o.useMemo(function(){if(w)return(0,u.default)(function(e){w(e)},300)},[w]),M=o.useRef(null),E=o.useRef(null),O=o.useRef(null),j=o.useState(null),S=j[0],C=j[1],D=o.useState(null),P=D[0],R=D[1],_=o.useState(null),T=_[0],I=_[1],L=o.useState({x:0,y:0}),N=L[0],z=L[1],B=o.useState(!1),U=B[0],q=B[1],A=o.useState([]),F=A[0],Y=A[1],$=o.useState(-1),X=$[0],W=$[1],G=o.useState(l),H=G[0],K=G[1];o.useLayoutEffect(function(){M.current&&!S&&C(M.current.getContext("2d"))},[M,S]),o.useLayoutEffect(function(){if(E.current&&!P){var e=E.current.getContext("2d");e&&(e.fillStyle="#ffffff",e.fillRect(0,0,N.x,N.y)),R(e)}},[E,N,P]),o.useLayoutEffect(function(){O.current&&!T&&I(O.current.getContext("2d"))},[O,T]),o.useEffect(function(){n(r,void 0,void 0,function(){var e,t,r;return a(this,function(o){switch(o.label){case 0:if(!c)return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(i=c,n(void 0,void 0,void 0,function(){var e,t;return a(this,function(r){switch(r.label){case 0:return[4,fetch(i)];case 1:if(!(e=r.sent()).ok)throw new Error("Failed to fetch image: ".concat(e.statusText));return[4,e.blob()];case 2:return t=r.sent(),[2,new Promise(function(e,r){var n=new FileReader;n.onloadend=function(){return e(n.result)},n.onerror=r,n.readAsDataURL(t)})]}})}))];case 2:return e=o.sent(),(t=new window.Image).onload=function(){z({x:t.width,y:t.height}),M.current&&(M.current.width=t.width,M.current.height=t.height),E.current&&(E.current.width=t.width,E.current.height=t.height),O.current&&(O.current.width=t.width,O.current.height=t.height),setTimeout(function(){var e,r=null===(e=M.current)||void 0===e?void 0:e.getContext("2d");null==r||r.clearRect(0,0,t.width,t.height),null==r||r.drawImage(t,0,0,t.width,t.height)},0)},t.src=e,[3,4];case 3:return r=o.sent(),console.error("Error loading image:",r),[3,4];case 4:return[2]}var i})})},[c]),o.useEffect(function(){K(l)},[l]),o.useEffect(function(){var e,t,r=function(e){T&&(T.clearRect(0,0,N.x,N.y),T.beginPath(),T.fillStyle=d,T.strokeStyle=d,T.globalAlpha=p+.1,T.arc(e.offsetX,e.offsetY,H,0,360),T.fill(),T.stroke()),P&&e.buttons>0&&(P.beginPath(),P.fillStyle=e.buttons>1||e.shiftKey?"#ffffff":d,P.arc(e.offsetX,e.offsetY,H,0,360),P.fill())},n=function(e){if(T){var t=Math.max(1,H+(e.deltaY>0?1:-1));K(t),null==m||m(t),T.clearRect(0,0,N.x,N.y),T.beginPath(),T.fillStyle=d,T.strokeStyle=d,T.globalAlpha=p+.1,T.arc(e.offsetX,e.offsetY,t,0,360),T.fill(),T.stroke(),e.stopPropagation(),e.preventDefault()}};return null===(e=O.current)||void 0===e||e.addEventListener("mousemove",r),m&&(null===(t=O.current)||void 0===t||t.addEventListener("wheel",n)),function(){var e,t;null===(e=O.current)||void 0===e||e.removeEventListener("mousemove",r),m&&(null===(t=O.current)||void 0===t||t.removeEventListener("wheel",n))}},[T,P,H,d,N,m]);var J=o.useCallback(function(e,t){if(P&&0!==N.x&&0!==N.y){var r=P.getImageData(0,0,N.x,N.y),n=(0,i.hexToRgb)(e);if(r&&n){for(var a=0;a<r.data.length;a+=4){var o=255===r.data[a]!=t?[255,255,255]:n;r.data[a]=o[0],r.data[a+1]=o[1],r.data[a+2]=o[2]}P.putImageData(r,0,0)}}},[P,N]);o.useEffect(function(){J(d,!1)},[d,N,J]);var Q=o.useCallback(function(){if(P&&0!==N.x&&0!==N.y)try{var e={imageData:P.getImageData(0,0,N.x,N.y),timestamp:Date.now()};Y(function(t){var r=t.slice(0,X+1);return r.push(e),r.slice(-50)}),W(function(e){return Math.min(e+1,49)})}catch(e){}},[P,N,X]),V=o.useCallback(function(e){if(P&&0!==N.x&&0!==N.y&&!(e<-1||e>=F.length))return-1===e?(P.clearRect(0,0,N.x,N.y),void W(-1)):void(F[e]&&(P.putImageData(F[e].imageData,0,0),W(e)))},[F,P,N]),Z=o.useCallback(function(e){e.preventDefault(),q(!0)},[]),ee=o.useCallback(function(e){e.preventDefault(),q(!1),setTimeout(function(){Q(),w&&E.current&&w((0,i.toMask)(E.current))},0)},[Q,w,E]);o.useEffect(function(){b(U)},[U,b]),o.useEffect(function(){if(w&&E.current)return U&&x&&x((0,i.toMask)(E.current)),function(){x&&x.cancel()}},[U,E,w]);var te=o.useCallback(function(){V(X-1),null==g||g(),w&&E.current&&w((0,i.toMask)(E.current))},[V,X,g,w,E]),re=o.useCallback(function(){F[X+1]&&(V(X+1),null==k||k(),w&&E.current&&w((0,i.toMask)(E.current)))},[V,F,X,k,w,E]),ne=o.useCallback(function(){P&&0!==N.x&&0!==N.y&&(P.clearRect(0,0,N.x,N.y),Y([]),W(-1),w&&E.current&&w((0,i.toMask)(E.current)))},[P,N,w,E]);return{canvasRef:M,maskCanvasRef:E,cursorCanvasRef:O,size:N,isDrawing:U,handleMouseDown:Z,handleMouseUp:ee,undo:te,redo:re,clear:ne,cursorSize:H,setCursorSize:K,maskColor:d,maskOpacity:p,maskBlendMode:h,history:F,historyIndex:X}}},607:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.toMask=t.MaskEditor=void 0,r(392),a(r(907),t),a(r(949),t);var o=r(513);Object.defineProperty(t,"MaskEditor",{enumerable:!0,get:function(){return o.MaskEditor}});var i=r(593);Object.defineProperty(t,"toMask",{enumerable:!0,get:function(){return i.toMask}})},593:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hexToRgb=t.toMask=void 0,t.toMask=function(e){var t=e.getContext("2d"),r={x:e.width,y:e.height};console.log(r);var n=null==t?void 0:t.getImageData(0,0,r.x,r.y),a=Uint8ClampedArray.from(n.data);if(n){for(var o=0;o<(null==n?void 0:n.data.length);o+=4){var i=255===n.data[o]?[255,255,255]:[0,0,0];n.data[o]=i[0],n.data[o+1]=i[1],n.data[o+2]=i[2],n.data[o+3]=255}null==t||t.putImageData(n,0,0)}var u=e.toDataURL();for(o=0;o<(null==n?void 0:n.data.length);o++)n.data[o]=a[o];return t.putImageData(n,0,0),u},t.hexToRgb=function(e){return e.replace("#","").match(/.{1,2}/g).map(function(e){return parseInt(e,16)})}},156:t=>{"use strict";t.exports=e}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var o=r[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}return n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(607)})());