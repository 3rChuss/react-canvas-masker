/*! For license information please see index.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports["@3rchuss/react-canvas-masker"]=t(require("react")):e["@3rchuss/react-canvas-masker"]=t(e.react)}(self,e=>(()=>{"use strict";var t={20:(e,t,r)=>{var a=r(155),o=Symbol.for("react.element"),n=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var a,n={},u=null,l=null;for(a in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,a)&&!c.hasOwnProperty(a)&&(n[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===n[a]&&(n[a]=t[a]);return{$$typeof:o,type:e,key:u,ref:l,props:n,_owner:i.current}}t.Fragment=n,t.jsx=u,t.jsxs=u},155:t=>{t.exports=e},156:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,o)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.toMask=t.MaskEditor=void 0,r(479),o(r(693),t),o(r(831),t);var n=r(900);Object.defineProperty(t,"MaskEditor",{enumerable:!0,get:function(){return n.MaskEditor}});var s=r(185);Object.defineProperty(t,"toMask",{enumerable:!0,get:function(){return s.toMask}})},185:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.simpleDebounce=t.hexToRgb=t.toMask=void 0,t.toMask=e=>{const t=e.getContext("2d"),r={x:e.width,y:e.height},a=t?.getImageData(0,0,r.x,r.y),o=Uint8ClampedArray.from(a.data);if(a){for(let e=0;e<a.data.length;e+=4){const t=0===a.data[e]&&0===a.data[e+1]&&0===a.data[e+2]?[0,0,0]:[255,255,255];a.data[e]=t[0],a.data[e+1]=t[1],a.data[e+2]=t[2],a.data[e+3]=255}t?.putImageData(a,0,0)}const n=e.toDataURL();for(let e=0;e<a?.data.length;e++)a.data[e]=o[e];return t.putImageData(a,0,0),n},t.hexToRgb=e=>e.replace("#","").match(/.{1,2}/g).map(e=>parseInt(e,16)),t.simpleDebounce=function(e,t){let r=null;const a=(...a)=>{r&&clearTimeout(r),r=setTimeout(()=>e(...a),t)};return a.cancel=()=>{r&&clearTimeout(r),r=null},a}},479:(e,t,r)=>{r.r(t)},693:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useMaskEditor=t.MaskEditorDefaults=void 0;const a=r(155),o=r(185);t.MaskEditorDefaults={cursorSize:10,maskOpacity:.4,maskColor:"#ffffff",maskBlendMode:"normal"},t.useMaskEditor=function(e){const{src:r,crossOrigin:n,maxWidth:s=1240,maxHeight:i=1240,cursorSize:c=t.MaskEditorDefaults.cursorSize,maskColor:u=t.MaskEditorDefaults.maskColor,maskBlendMode:l=t.MaskEditorDefaults.maskBlendMode,maskOpacity:d=t.MaskEditorDefaults.maskOpacity,onCursorSizeChange:f,onDrawingChange:h,onUndoRequest:m,onRedoRequest:y,onMaskChange:g}=e,k=a.useMemo(()=>{if(g)return(0,o.simpleDebounce)(e=>{g(e)},300)},[g]),p=a.useRef(null),v=a.useRef(null),w=a.useRef(null),[x,M]=a.useState(null),[b,E]=a.useState(null),[C,D]=a.useState(null),[_,R]=a.useState({x:0,y:0}),[S,O]=a.useState(!1),[P,j]=a.useState([]),[T,I]=a.useState(-1),[L,z]=a.useState(c),[N,U]=a.useState(0);a.useLayoutEffect(()=>{p.current&&!x&&M(p.current.getContext("2d"))},[p,x]),a.useLayoutEffect(()=>{if(v.current&&!b){const e=v.current.getContext("2d");e&&(e.fillStyle="#ffffff",e.fillRect(0,0,_.x,_.y)),E(e)}},[v,_,b]),a.useLayoutEffect(()=>{w.current&&!C&&D(w.current.getContext("2d"))},[w,C]),a.useEffect(()=>{(async()=>{if(r)try{const e=await(async e=>{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch image: ${t.statusText}`);const r=await t.blob();return new Promise((e,t)=>{const a=new FileReader;a.onloadend=()=>e(a.result),a.onerror=t,a.readAsDataURL(r)})})(r),t=new window.Image;n&&(t.crossOrigin=n),t.onload=()=>{let e=t.width,r=t.height;if(t.width>s||t.height>i){const a=s/t.width,o=i/t.height,n=Math.min(a,o);e=Math.round(t.width*n),r=Math.round(t.height*n)}R({x:e,y:r}),p.current&&(p.current.width=e,p.current.height=r),v.current&&(v.current.width=e,v.current.height=r),w.current&&(w.current.width=e,w.current.height=r),setTimeout(()=>{const a=p.current?.getContext("2d");a?.clearRect(0,0,e,r),a?.drawImage(t,0,0,e,r)},0)},setTimeout(()=>{t.src=e},0),U(e=>e+1)}catch(e){console.error("Error loading image:",e),console.error("Trying to load image from src directly");const t=new window.Image;n&&(t.crossOrigin=n),t.onload=()=>{let e=t.width,r=t.height;if(t.width>s||t.height>i){const a=s/t.width,o=i/t.height,n=Math.min(a,o);e=Math.round(t.width*n),r=Math.round(t.height*n)}R({x:e,y:r}),p.current&&(p.current.width=e,p.current.height=r),v.current&&(v.current.width=e,v.current.height=r),w.current&&(w.current.width=e,w.current.height=r),setTimeout(()=>{const a=p.current?.getContext("2d");a?.clearRect(0,0,e,r),a?.drawImage(t,0,0,e,r)},0)},setTimeout(()=>{t.src=r},0),U(e=>e+1)}})()},[r,n,s,i]),a.useEffect(()=>{z(c)},[c]),a.useEffect(()=>{const e=e=>{C&&(C.clearRect(0,0,_.x,_.y),C.beginPath(),C.fillStyle=u,C.strokeStyle=u,C.globalAlpha=d+.1,C.arc(e.offsetX,e.offsetY,L,0,360),C.fill(),C.stroke()),b&&e.buttons>0&&(b.beginPath(),b.fillStyle=e.buttons>1||e.shiftKey?"#ffffff":u,b.arc(e.offsetX,e.offsetY,L,0,360),b.fill())},t=e=>{if(C){const t=Math.max(1,L+(e.deltaY>0?1:-1));z(t),f?.(t),C.clearRect(0,0,_.x,_.y),C.beginPath(),C.fillStyle=u,C.strokeStyle=u,C.globalAlpha=d+.1,C.arc(e.offsetX,e.offsetY,t,0,360),C.fill(),C.stroke(),e.stopPropagation(),e.preventDefault()}};return w.current?.addEventListener("mousemove",e),f&&w.current?.addEventListener("wheel",t),()=>{w.current?.removeEventListener("mousemove",e),f&&w.current?.removeEventListener("wheel",t)}},[C,b,L,u,_,f]);const B=a.useCallback((e,t)=>{if(!b)return;if(0===_.x||0===_.y)return;const r=b.getImageData(0,0,_.x,_.y),a=(0,o.hexToRgb)(e);if(r&&a){for(let e=0;e<r.data.length;e+=4){const o=255===r.data[e]!=t?[255,255,255]:a;r.data[e]=o[0],r.data[e+1]=o[1],r.data[e+2]=o[2]}b.putImageData(r,0,0)}},[b,_,u]);a.useEffect(()=>{B(u,!1)},[u,_,B]);const A=a.useCallback(()=>{if(b&&0!==_.x&&0!==_.y)try{const e={imageData:b.getImageData(0,0,_.x,_.y),timestamp:Date.now()};j(t=>{const r=t.slice(0,T+1);return r.push(e),r.slice(-50)}),I(e=>Math.min(e+1,49))}catch(e){}},[b,_,T]),K=a.useCallback(e=>{if(b&&0!==_.x&&0!==_.y&&!(e<-1||e>=P.length))return-1===e?(b.clearRect(0,0,_.x,_.y),void I(-1)):void(P[e]&&(b.putImageData(P[e].imageData,0,0),I(e)))},[P,b,_]),Y=a.useCallback(e=>{e.preventDefault(),O(!0)},[]),q=a.useCallback(e=>{e.preventDefault(),O(!1),setTimeout(()=>{A(),g&&v.current&&g((0,o.toMask)(v.current))},0)},[A,g,v]);a.useEffect(()=>{h(S)},[S,h]),a.useEffect(()=>{if(g&&v.current)return S&&k&&k((0,o.toMask)(v.current)),()=>{k&&k.cancel()}},[S,v,g]);const F=a.useCallback(()=>{K(T-1),m?.(),g&&v.current&&g((0,o.toMask)(v.current))},[K,T,m,g,v]),X=a.useCallback(()=>{P[T+1]&&(K(T+1),y?.(),g&&v.current&&g((0,o.toMask)(v.current)))},[K,P,T,y,g,v]),$=a.useCallback(()=>{b&&0!==_.x&&0!==_.y&&(b.clearRect(0,0,_.x,_.y),j([]),I(-1),g&&v.current&&g((0,o.toMask)(v.current)))},[b,_,g,v]);return a.useEffect(()=>{const e=e=>{const t=e.target?.tagName;"INPUT"===t||"TEXTAREA"===t||e.target?.isContentEditable||(!e.ctrlKey&&!e.metaKey||e.shiftKey||"z"!==e.key.toLowerCase()?(e.ctrlKey||e.metaKey)&&("y"===e.key.toLowerCase()||e.shiftKey&&"z"===e.key.toLowerCase())&&(e.preventDefault(),X()):(e.preventDefault(),F()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[F,X]),{canvasRef:p,maskCanvasRef:v,cursorCanvasRef:w,size:_,isDrawing:S,key:N,handleMouseDown:Y,handleMouseUp:q,undo:F,redo:X,clear:$,cursorSize:L,setCursorSize:z,maskColor:u,maskOpacity:d,maskBlendMode:l,history:P,historyIndex:T}}},831:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useMaskEditorContext=t.MaskEditorProvider=void 0;const a=r(848),o=r(155),n=r(693),s=o.createContext(void 0);t.MaskEditorProvider=({children:e,...t})=>{const r=(0,n.useMaskEditor)(t);return(0,a.jsx)(s.Provider,{value:r,children:e})},t.useMaskEditorContext=function(){const e=o.useContext(s);if(!e)throw new Error("useMaskEditorContext must be used within a MaskEditorProvider");return e}},848:(e,t,r)=>{e.exports=r(20)},900:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MaskEditor=void 0;const a=r(848),o=r(155);r(479);const n=r(693);t.MaskEditor=e=>{const{canvasRef:t,...r}=e,{canvasRef:s,clear:i,cursorCanvasRef:c,handleMouseDown:u,handleMouseUp:l,key:d,maskBlendMode:f,maskCanvasRef:h,maskOpacity:m,redo:y,size:g,undo:k}=(0,n.useMaskEditor)(r);return o.useImperativeHandle(t,()=>({maskCanvas:h.current,undo:k,redo:y,clear:i}),[h,k,y,i]),(0,a.jsx)("div",{className:"react-mask-editor-outer",children:(0,a.jsxs)("div",{className:"react-mask-editor-inner",style:{width:g.x,height:g.y},children:[(0,a.jsx)("canvas",{ref:s,style:{width:g.x,height:g.y},width:g.x,height:g.y,className:"react-mask-editor-base-canvas"},d),(0,a.jsx)("canvas",{ref:h,width:g.x,height:g.y,style:{width:g.x,height:g.y,opacity:m,mixBlendMode:f},className:"react-mask-editor-mask-canvas"}),(0,a.jsx)("canvas",{ref:c,width:g.x,height:g.y,onMouseUp:l,onMouseDown:u,style:{width:g.x,height:g.y},className:"react-mask-editor-cursor-canvas"})]})})}}},r={};function a(e){var o=r[e];if(void 0!==o)return o.exports;var n=r[e]={exports:{}};return t[e].call(n.exports,n,n.exports,a),n.exports}return a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a(156)})());