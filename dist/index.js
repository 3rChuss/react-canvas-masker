!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports["@3rchuss/react-canvas-masker"]=t(require("react")):e["@3rchuss/react-canvas-masker"]=t(e.react)}(self,e=>(()=>{"use strict";var t={392:(e,t,r)=>{r.r(t)},513:function(e,t,r){var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.MaskEditor=void 0;var a=r(156);r(392);var o=r(907);t.MaskEditor=function(e){var t=e.canvasRef,r=n(e,["canvasRef"]),i=(0,o.useMaskEditor)(r),u=i.canvasRef,c=i.clear,s=i.cursorCanvasRef,l=i.handleMouseDown,f=i.handleMouseUp,d=i.key,h=i.maskBlendMode,v=i.maskCanvasRef,y=i.maskOpacity,m=i.redo,p=i.size,g=i.undo;return a.useImperativeHandle(t,function(){return{maskCanvas:v.current,undo:g,redo:m,clear:c}},[v,g,m,c]),a.createElement("div",{className:"react-mask-editor-outer"},a.createElement("div",{className:"react-mask-editor-inner",style:{width:p.x,height:p.y}},a.createElement("canvas",{key:d,ref:u,style:{width:p.x,height:p.y},width:p.x,height:p.y,className:"react-mask-editor-base-canvas"}),a.createElement("canvas",{ref:v,width:p.x,height:p.y,style:{width:p.x,height:p.y,opacity:y,mixBlendMode:h},className:"react-mask-editor-mask-canvas"}),a.createElement("canvas",{ref:s,width:p.x,height:p.y,onMouseUp:f,onMouseDown:l,style:{width:p.x,height:p.y},className:"react-mask-editor-cursor-canvas"})))}},949:function(e,t,r){var n=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.useMaskEditorContext=t.MaskEditorProvider=void 0;var a=r(156),o=r(907),i=a.createContext(void 0);t.MaskEditorProvider=function(e){var t=e.children,r=n(e,["children"]),u=(0,o.useMaskEditor)(r);return a.createElement(i.Provider,{value:u},t)},t.useMaskEditorContext=function(){var e=a.useContext(i);if(!e)throw new Error("useMaskEditorContext must be used within a MaskEditorProvider");return e}},907:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function u(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,u)}c((n=n.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(c){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&u[0]?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){i.label=u[1];break}if(6===u[0]&&i.label<a[1]){i.label=a[1],a=u;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(u);break}a[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],n=0}finally{r=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.useMaskEditor=t.MaskEditorDefaults=void 0;var o=r(156),i=r(593);t.MaskEditorDefaults={cursorSize:10,maskOpacity:.4,maskColor:"#ffffff",maskBlendMode:"normal"},t.useMaskEditor=function(e){var r=this,u=e.src,c=e.crossOrigin,s=e.maxWidth,l=void 0===s?1240:s,f=e.maxHeight,d=void 0===f?1240:f,h=e.cursorSize,v=void 0===h?t.MaskEditorDefaults.cursorSize:h,y=e.maskColor,m=void 0===y?t.MaskEditorDefaults.maskColor:y,p=e.maskBlendMode,g=void 0===p?t.MaskEditorDefaults.maskBlendMode:p,k=e.maskOpacity,b=void 0===k?t.MaskEditorDefaults.maskOpacity:k,w=e.onCursorSizeChange,x=e.onDrawingChange,M=e.onUndoRequest,E=e.onRedoRequest,O=e.onMaskChange,C=o.useMemo(function(){if(O)return(0,i.simpleDebounce)(function(e){O(e)},300)},[O]),S=o.useRef(null),D=o.useRef(null),P=o.useRef(null),R=o.useState(null),_=R[0],j=R[1],T=o.useState(null),I=T[0],L=T[1],z=o.useState(null),U=z[0],B=z[1],K=o.useState({x:0,y:0}),N=K[0],A=K[1],q=o.useState(!1),X=q[0],Y=q[1],F=o.useState([]),H=F[0],G=F[1],W=o.useState(-1),J=W[0],Q=W[1],V=o.useState(v),Z=V[0],$=V[1],ee=o.useState(0),te=ee[0],re=ee[1];o.useLayoutEffect(function(){S.current&&!_&&j(S.current.getContext("2d"))},[S,_]),o.useLayoutEffect(function(){if(D.current&&!I){var e=D.current.getContext("2d");e&&(e.fillStyle="#ffffff",e.fillRect(0,0,N.x,N.y)),L(e)}},[D,N,I]),o.useLayoutEffect(function(){P.current&&!U&&B(P.current.getContext("2d"))},[P,U]),o.useEffect(function(){n(r,void 0,void 0,function(){var e,t,r,o;return a(this,function(i){switch(i.label){case 0:if(!u)return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,(s=u,n(void 0,void 0,void 0,function(){var e,t;return a(this,function(r){switch(r.label){case 0:return[4,fetch(s)];case 1:if(!(e=r.sent()).ok)throw new Error("Failed to fetch image: ".concat(e.statusText));return[4,e.blob()];case 2:return t=r.sent(),[2,new Promise(function(e,r){var n=new FileReader;n.onloadend=function(){return e(n.result)},n.onerror=r,n.readAsDataURL(t)})]}})}))];case 2:return e=i.sent(),t=new window.Image,c&&(t.crossOrigin=c),t.onload=function(){var e=t.width,r=t.height;if(t.width>l||t.height>d){var n=l/t.width,a=d/t.height,o=Math.min(n,a);e=Math.round(t.width*o),r=Math.round(t.height*o)}A({x:e,y:r}),S.current&&(S.current.width=e,S.current.height=r),D.current&&(D.current.width=e,D.current.height=r),P.current&&(P.current.width=e,P.current.height=r),setTimeout(function(){var n,a=null===(n=S.current)||void 0===n?void 0:n.getContext("2d");null==a||a.clearRect(0,0,e,r),null==a||a.drawImage(t,0,0,e,r)},0)},setTimeout(function(){t.src=e},0),re(function(e){return e+1}),[3,4];case 3:return r=i.sent(),console.error("Error loading image:",r),console.error("Trying to load image from src directly"),o=new window.Image,c&&(o.crossOrigin=c),o.onload=function(){var e=o.width,t=o.height;if(o.width>l||o.height>d){var r=l/o.width,n=d/o.height,a=Math.min(r,n);e=Math.round(o.width*a),t=Math.round(o.height*a)}A({x:e,y:t}),S.current&&(S.current.width=e,S.current.height=t),D.current&&(D.current.width=e,D.current.height=t),P.current&&(P.current.width=e,P.current.height=t),setTimeout(function(){var r,n=null===(r=S.current)||void 0===r?void 0:r.getContext("2d");null==n||n.clearRect(0,0,e,t),null==n||n.drawImage(o,0,0,e,t)},0)},setTimeout(function(){o.src=u},0),re(function(e){return e+1}),[3,4];case 4:return[2]}var s})})},[u,c,l,d]),o.useEffect(function(){$(v)},[v]),o.useEffect(function(){var e,t,r=function(e){U&&(U.clearRect(0,0,N.x,N.y),U.beginPath(),U.fillStyle=m,U.strokeStyle=m,U.globalAlpha=b+.1,U.arc(e.offsetX,e.offsetY,Z,0,360),U.fill(),U.stroke()),I&&e.buttons>0&&(I.beginPath(),I.fillStyle=e.buttons>1||e.shiftKey?"#ffffff":m,I.arc(e.offsetX,e.offsetY,Z,0,360),I.fill())},n=function(e){if(U){var t=Math.max(1,Z+(e.deltaY>0?1:-1));$(t),null==w||w(t),U.clearRect(0,0,N.x,N.y),U.beginPath(),U.fillStyle=m,U.strokeStyle=m,U.globalAlpha=b+.1,U.arc(e.offsetX,e.offsetY,t,0,360),U.fill(),U.stroke(),e.stopPropagation(),e.preventDefault()}};return null===(e=P.current)||void 0===e||e.addEventListener("mousemove",r),w&&(null===(t=P.current)||void 0===t||t.addEventListener("wheel",n)),function(){var e,t;null===(e=P.current)||void 0===e||e.removeEventListener("mousemove",r),w&&(null===(t=P.current)||void 0===t||t.removeEventListener("wheel",n))}},[U,I,Z,m,N,w]);var ne=o.useCallback(function(e,t){if(I&&0!==N.x&&0!==N.y){var r=I.getImageData(0,0,N.x,N.y),n=(0,i.hexToRgb)(e);if(r&&n){for(var a=0;a<r.data.length;a+=4){var o=255===r.data[a]!=t?[255,255,255]:n;r.data[a]=o[0],r.data[a+1]=o[1],r.data[a+2]=o[2]}I.putImageData(r,0,0)}}},[I,N,m]);o.useEffect(function(){ne(m,!1)},[m,N,ne]);var ae=o.useCallback(function(){if(I&&0!==N.x&&0!==N.y)try{var e={imageData:I.getImageData(0,0,N.x,N.y),timestamp:Date.now()};G(function(t){var r=t.slice(0,J+1);return r.push(e),r.slice(-50)}),Q(function(e){return Math.min(e+1,49)})}catch(e){}},[I,N,J]),oe=o.useCallback(function(e){if(I&&0!==N.x&&0!==N.y&&!(e<-1||e>=H.length))return-1===e?(I.clearRect(0,0,N.x,N.y),void Q(-1)):void(H[e]&&(I.putImageData(H[e].imageData,0,0),Q(e)))},[H,I,N]),ie=o.useCallback(function(e){e.preventDefault(),Y(!0)},[]),ue=o.useCallback(function(e){e.preventDefault(),Y(!1),setTimeout(function(){ae(),O&&D.current&&O((0,i.toMask)(D.current))},0)},[ae,O,D]);o.useEffect(function(){x(X)},[X,x]),o.useEffect(function(){if(O&&D.current)return X&&C&&C((0,i.toMask)(D.current)),function(){C&&C.cancel()}},[X,D,O]);var ce=o.useCallback(function(){oe(J-1),null==M||M(),O&&D.current&&O((0,i.toMask)(D.current))},[oe,J,M,O,D]),se=o.useCallback(function(){H[J+1]&&(oe(J+1),null==E||E(),O&&D.current&&O((0,i.toMask)(D.current)))},[oe,H,J,E,O,D]),le=o.useCallback(function(){I&&0!==N.x&&0!==N.y&&(I.clearRect(0,0,N.x,N.y),G([]),Q(-1),O&&D.current&&O((0,i.toMask)(D.current)))},[I,N,O,D]);return o.useEffect(function(){var e=function(e){var t,r,n=null===(t=e.target)||void 0===t?void 0:t.tagName;"INPUT"===n||"TEXTAREA"===n||(null===(r=e.target)||void 0===r?void 0:r.isContentEditable)||(!e.ctrlKey&&!e.metaKey||e.shiftKey||"z"!==e.key.toLowerCase()?(e.ctrlKey||e.metaKey)&&("y"===e.key.toLowerCase()||e.shiftKey&&"z"===e.key.toLowerCase())&&(e.preventDefault(),se()):(e.preventDefault(),ce()))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}},[ce,se]),{canvasRef:S,maskCanvasRef:D,cursorCanvasRef:P,size:N,isDrawing:X,key:te,handleMouseDown:ie,handleMouseUp:ue,undo:ce,redo:se,clear:le,cursorSize:Z,setCursorSize:$,maskColor:m,maskOpacity:b,maskBlendMode:g,history:H,historyIndex:J}}},607:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.toMask=t.MaskEditor=void 0,r(392),a(r(907),t),a(r(949),t);var o=r(513);Object.defineProperty(t,"MaskEditor",{enumerable:!0,get:function(){return o.MaskEditor}});var i=r(593);Object.defineProperty(t,"toMask",{enumerable:!0,get:function(){return i.toMask}})},593:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.simpleDebounce=t.hexToRgb=t.toMask=void 0,t.toMask=function(e){var t=e.getContext("2d"),r={x:e.width,y:e.height},n=null==t?void 0:t.getImageData(0,0,r.x,r.y),a=Uint8ClampedArray.from(n.data);if(n){for(var o=0;o<n.data.length;o+=4){var i=0===n.data[o]&&0===n.data[o+1]&&0===n.data[o+2]?[0,0,0]:[255,255,255];n.data[o]=i[0],n.data[o+1]=i[1],n.data[o+2]=i[2],n.data[o+3]=255}null==t||t.putImageData(n,0,0)}var u=e.toDataURL();for(o=0;o<(null==n?void 0:n.data.length);o++)n.data[o]=a[o];return t.putImageData(n,0,0),u},t.hexToRgb=function(e){return e.replace("#","").match(/.{1,2}/g).map(function(e){return parseInt(e,16)})},t.simpleDebounce=function(e,t){var r=null,n=function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];r&&clearTimeout(r),r=setTimeout(function(){return e.apply(void 0,n)},t)};return n.cancel=function(){r&&clearTimeout(r),r=null},n}},156:t=>{t.exports=e}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var o=r[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}return n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(607)})());